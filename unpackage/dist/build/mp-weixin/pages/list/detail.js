"use strict";const e=require("../../common/vendor.js"),t=e.tr.database(),i=t.collection("read-news-log"),o={data:()=>({id:"",title:"title",formData:{noData:'<p style="text-align:center;color:#666">详情加载中...</p>'}}),computed:{uniStarterConfig:()=>getApp().globalData.config,where(){return`_id =="${this.id}"`},colList(){return[t.collection("opendb-news-articles").where(this.where).field("user_id,_id,avatar,excerpt,last_modify_date,comment_count,like_count,title,content").getTemp(),t.collection("uni-id-users").field("_id,nickname").getTemp()]}},onLoad(t){t.id&&(this.id=t.id),t.title&&(this.title=t.title,e.index.setNavigationBarTitle({title:t.title}))},onReady(){this.id?this.$refs.detail.loadData():e.index.showToast({icon:"none",title:this.$t("listDetail.newsErr")})},onNavigationBarButtonTap(e){"share"==e.type&&this.shareClick()},methods:{$log(...e){console.log("args",...e,this.id)},setReadNewsLog(){let t={article_id:this.id,last_time:Date.now()},i=e.index.getStorageSync("readNewsLog")||[],o=-1;i.forEach((({article_id:e},i)=>{e==t.article_id&&(o=i)})),-1===o?i.push(t):i.splice(o,1,t),e.index.setStorageSync("readNewsLog",i),console.log(i)},setFavorite(){if(e.tr.getCurrentUserInfo().tokenExpired<Date.now())return console.log("未登录用户");let t=this.id,o=Date.now();console.log({article_id:t,last_time:o}),i.where(`"article_id" == "${t}" && "user_id"==$env.uid`).update({last_time:o}).then((({result:{updated:e}})=>{console.log("updated",e),e||i.add({article_id:t}).then((e=>{console.log(e)})).catch((e=>{console.log(e)}))})).catch((e=>{console.log(e)}))},loadData(t){""==this.title&&t[0].title&&(this.title=t[0].title,e.index.setNavigationBarTitle({title:t[0].title})),this.setReadNewsLog()},followClick(){e.index.showToast({title:this.$t("listDetail.follow"),icon:"none"})}}};if(!Array){(e.resolveComponent("uni-dateformat")+e.resolveComponent("uni-list-item")+e.resolveComponent("uni-list")+e.resolveComponent("unicloud-db"))()}Math||((()=>"../../uni_modules/uni-dateformat/components/uni-dateformat/uni-dateformat.js")+(()=>"../../uni_modules/uni-list/components/uni-list-item/uni-list-item.js")+(()=>"../../uni_modules/uni-list/components/uni-list/uni-list.js")+(()=>"../../node-modules/@dcloudio/uni-components/lib/unicloud-db/unicloud-db.js"))();const a=e._export_sfc(o,[["render",function(t,i,o,a,n,l){return{a:e.t(n.title),b:e.w((({data:t,loading:i,error:o,options:a},n,l)=>e.e({a:!i&&t},!i&&t?{b:e.t(t.user_id&&t.user_id[0]&&t.user_id[0].nickname||"未知"),c:"b2da6fae-3-"+l+",b2da6fae-2-"+l,d:e.p({date:t.last_modify_date,format:"yyyy-MM-dd hh:mm",threshold:[6e4,2592e6]}),e:"b2da6fae-2-"+l+",b2da6fae-1-"+l,f:e.p({thumbSize:"lg",thumb:t.image}),g:"b2da6fae-1-"+l+",b2da6fae-0",h:e.p({border:!1}),i:t.avatar,j:e.t(t.excerpt),k:t.content}:{},{l:l,m:n})),{name:"d",path:"b",vueId:"b2da6fae-0"}),c:e.sr("detail","b2da6fae-0"),d:e.o(l.loadData),e:e.p({options:n.formData,collection:l.colList,getone:!0,manual:!0,foreignKey:"opendb-news-articles.user_id"})}}],["__scopeId","data-v-b2da6fae"]]);wx.createPage(a);
