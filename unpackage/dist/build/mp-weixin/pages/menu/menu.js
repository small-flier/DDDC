"use strict";const e=require("../../common/vendor.js"),a={onShow(){const a=e.index.getStorageSync("tabbarParams");if(a.id){e.index.removeStorageSync("tabbarParams");e.tr.database().collection("menu").where({_id:a.id}).get().then((e=>{e.result&&e.result.data&&(this.formData=e.result.data[0],this.imageValue=e.result.data[0].file)}))}},onHide(){},data:()=>({imageValue:[],formData:{},rules:{name:{rules:[{required:!0,errorMessage:"菜名不能为空"}]},type:{rules:[{required:!0,errorMessage:"分类不能为空"}]}},range:[{value:"荤菜",text:"荤菜"},{value:"花荤",text:"花荤"},{value:"素菜",text:"素菜"},{value:"果汁",text:"果汁"},{value:"汤",text:"汤"},{value:"奶茶",text:"奶茶"},{value:"其他",text:"其他"}],loading:!1,isUpload:!1}),methods:{formSubmit(){this.$refs.baseFormRef.validate().then((a=>{let t={...this.formData};if(this.imageValue&&this.imageValue[0]){const{name:e,extname:a,url:o}=this.imageValue[0];t={...this.formData,file:{name:e,extname:a,url:o}}}this.isUpload?e.index.showToast({title:"请等待图片上传完成",icon:"none"}):(this.loading=!0,this.formData._id?this.update(t):this.add(t))})).catch((e=>{console.log("err",e)}))},add(a){e.tr.database().collection("menu").add(a).then((e=>{this.operSuccess()})).catch((e=>{console.error("新增失败",e)})).finally((()=>{this.loading=!1}))},update(a){e.tr.database().collection("menu").where({_id:this.formData._id}).update(a).then((()=>{this.operSuccess()})).finally((()=>{this.loading=!1}))},operSuccess(){e.index.showToast({title:"操作成功"}),setTimeout((()=>{this.imageValue=[],this.formData={},e.index.setStorageSync("needFetch",!0),e.index.switchTab({url:"/pages/grid/grid"})}),1e3)},select(e){this.isUpload=!0,console.log("选择文件：",e)},progress(e){console.log("上传进度：",e)},success(e){console.log("上传成功",e),this.isUpload=!1},fail(e){console.log("上传失败：",e),this.noClear=!1}}};if(!Array){(e.resolveComponent("uni-easyinput")+e.resolveComponent("uni-forms-item")+e.resolveComponent("uni-data-select")+e.resolveComponent("uni-file-picker")+e.resolveComponent("uni-forms"))()}Math||((()=>"../../uni_modules/uni-easyinput/components/uni-easyinput/uni-easyinput.js")+(()=>"../../uni_modules/uni-forms/components/uni-forms-item/uni-forms-item.js")+(()=>"../../uni_modules/uni-data-select/components/uni-data-select/uni-data-select.js")+(()=>"../../uni_modules/uni-file-picker/components/uni-file-picker/uni-file-picker.js")+(()=>"../../uni_modules/uni-forms/components/uni-forms/uni-forms.js"))();const t=e._export_sfc(a,[["render",function(a,t,o,i,s,n){return{a:e.o((e=>s.formData.name=e)),b:e.p({placeholder:"请输入菜名",modelValue:s.formData.name}),c:e.p({label:"菜名",required:!0,name:"name"}),d:e.o((e=>s.formData.type=e)),e:e.p({localdata:s.range,placeholder:"请选择分类",modelValue:s.formData.type}),f:e.p({label:"分类",required:!0,name:"type"}),g:e.o(n.select),h:e.o(n.progress),i:e.o(n.success),j:e.o(n.fail),k:e.o((e=>s.imageValue=e)),l:e.p({fileMediatype:"image",mode:"grid",limit:1,modelValue:s.imageValue}),m:e.p({label:"图片"}),n:e.sr("baseFormRef","62c74c86-0"),o:e.p({rules:s.rules,modelValue:s.formData,"label-position":"top"}),p:s.loading,q:e.o(((...e)=>n.formSubmit&&n.formSubmit(...e)))}}]]);wx.createPage(t);
