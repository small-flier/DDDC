"use strict";const e=require("../../common/vendor.js"),o={onShow(){const o=e.index.getStorageSync("tabbarParams");if(o.id){e.index.removeStorageSync("tabbarParams");e.tr.database().collection("menu").where({_id:o.id}).get().then((e=>{e.result&&e.result.data&&(this.formData=e.result.data[0],this.imageValue=e.result.data[0].file)}))}},onHide(){},data:()=>({imageValue:[],formData:{},rules:{name:{rules:[{required:!0,errorMessage:"菜名不能为空"}]}},loading:!1,isUpload:!1}),methods:{formSubmit(){this.$refs.baseFormRef.validate().then((o=>{let i={...this.formData};if(this.imageValue&&this.imageValue[0]){const{name:e,extname:o,url:a}=this.imageValue[0];i={...this.formData,file:{name:e,extname:o,url:a}}}this.isUpload?e.index.showToast({title:"请等待图片上传完成",icon:"none"}):(this.loading=!0,this.formData._id?this.update(i):this.add(i))})).catch((e=>{console.log("err",e)}))},add(o){e.tr.database().collection("menu").add(o).then((e=>{this.operSuccess()})).catch((e=>{console.error("新增失败",e)})).finally((()=>{this.loading=!1}))},update(o){e.tr.database().collection("menu").where({_id:this.formData._id}).update(o).then((()=>{this.operSuccess()})).finally((()=>{this.loading=!1}))},operSuccess(){e.index.showToast({title:"操作成功"}),setTimeout((()=>{this.imageValue=[],this.formData={},e.index.setStorageSync("needFetch",!0),e.index.switchTab({url:"/pages/grid/grid"})}),1e3)},select(e){this.isUpload=!0,console.log("选择文件：",e)},progress(e){console.log("上传进度：",e)},success(e){console.log("上传成功",e),this.isUpload=!1},fail(e){console.log("上传失败：",e),this.noClear=!1}}};if(!Array){(e.resolveComponent("uni-easyinput")+e.resolveComponent("uni-forms-item")+e.resolveComponent("uni-file-picker")+e.resolveComponent("uni-forms"))()}Math||((()=>"../../uni_modules/uni-easyinput/components/uni-easyinput/uni-easyinput.js")+(()=>"../../uni_modules/uni-forms/components/uni-forms-item/uni-forms-item.js")+(()=>"../../uni_modules/uni-file-picker/components/uni-file-picker/uni-file-picker.js")+(()=>"../../uni_modules/uni-forms/components/uni-forms/uni-forms.js"))();const i=e._export_sfc(o,[["render",function(o,i,a,t,s,n){return{a:e.o((e=>s.formData.name=e)),b:e.p({placeholder:"请输入菜名",modelValue:s.formData.name}),c:e.p({label:"菜名",required:!0,name:"name"}),d:e.o(n.select),e:e.o(n.progress),f:e.o(n.success),g:e.o(n.fail),h:e.o((e=>s.imageValue=e)),i:e.p({fileMediatype:"image",mode:"grid",limit:1,modelValue:s.imageValue}),j:e.p({label:"图片"}),k:e.sr("baseFormRef","62c74c86-0"),l:e.p({rules:s.rules,modelValue:s.formData,"label-position":"top"}),m:s.loading,n:e.o(((...e)=>n.formSubmit&&n.formSubmit(...e)))}}]]);wx.createPage(i);
