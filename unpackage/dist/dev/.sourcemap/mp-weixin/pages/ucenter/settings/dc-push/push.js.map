{"version":3,"file":"push.js","sources":["pages/ucenter/settings/dc-push/push.js"],"sourcesContent":["/**\r\n * 判断Push是否开启\r\n */\r\nfunction isTurnedOnPush(){\r\n\tvar isOn = undefined;\r\n\ttry{\r\n\t\tif('iOS' == plus.os.name){\r\n\t\t\tvar types = 0;\r\n\t\t\tvar app = plus.ios.invoke('UIApplication', 'sharedApplication');\r\n\t\t\tvar settings = plus.ios.invoke(app, 'currentUserNotificationSettings');\r\n\t\t\tif(settings){\r\n\t\t\t\ttypes = settings.plusGetAttribute('types');\r\n\t\t\t\tplus.ios.deleteObject(settings);\r\n\t\t\t}else{\r\n\t\t\t\ttypes = plus.ios.invoke(app, 'enabledRemoteNotificationTypes');\r\n\t\t\t}\r\n\t\t\tplus.ios.deleteObject(app);\r\n\t\t\tisOn = (0!=types);\r\n\t\t}else{\r\n\t\t\tvar main = plus.android.runtimeMainActivity();\r\n\t\t\tvar manager = plus.android.invoke('com.igexin.sdk.PushManager', 'getInstance');\r\n\t\t\tisOn = plus.android.invoke(manager, 'isPushTurnedOn', main);\r\n\t\t}\r\n\t}catch(e){\r\n\t\tconsole.error('exception in isTurnedOnPush@dc-push!!');\r\n\t}\r\n\treturn isOn;\r\n}\r\n\r\n/**\r\n * 打开Push\r\n * Android平台 - 打开个推（UniPush）的推送通道\r\n * iOS平台 - 如果开启通知功能，则打开应用的设置页面引导用户开启通知\r\n */\r\nfunction turnOnPush(){\r\n\ttry{\r\n\t\tif('iOS' == plus.os.name){\r\n\t\t\t// 如果设置中没有开启通知，则打开应用的设置界面\r\n\t\t\tif(!isTurnedOnPush()){\r\n\t\t\t\tsettingInIos();\r\n\t\t\t}\r\n\t\t}else{\r\n\t\t\tvar main = plus.android.runtimeMainActivity();\r\n\t\t\tvar manager = plus.android.invoke('com.igexin.sdk.PushManager', 'getInstance');\r\n\t\t\tplus.android.invoke(manager, 'turnOnPush', main);\r\n\t\t}\r\n\t}catch(e){\r\n\t\tconsole.error('exception in turnOnPush@dc-push!!');\r\n\t}\r\n}\r\n\r\n/**\r\n * 关闭Push\r\n * Android平台 - 关闭个推（UniPush）的推送通道\r\n * iOS平台 - 不做任何操作\r\n */\r\nfunction trunOffPush(){\r\n\ttry{\r\n\t\tif('iOS' == plus.os.name){\r\n\t\t\t// 这里不做任何操作（不引导用户关闭应用的推送能力），应该通知业务服务器不向此用户下发推送消息\r\n\t\t}else{\r\n\t\t\tvar main = plus.android.runtimeMainActivity();\r\n\t\t\tvar manager = plus.android.invoke('com.igexin.sdk.PushManager', 'getInstance');\r\n\t\t\tplus.android.invoke(manager, 'turnOffPush', main);\r\n\t\t}\r\n\t}catch(e){\r\n\t\tconsole.error('exception in trunOffPush@dc-push!!');\r\n\t}\r\n}\r\n\r\n/**\r\n * iOS平台打开应用设置界面\r\n */\r\nfunction settingInIos(){\r\n\ttry{\r\n\tif('iOS' == plus.os.name){\r\n\t\tvar app = plus.ios.invoke('UIApplication', 'sharedApplication');\r\n\t\tvar setting = plus.ios.invoke('NSURL', 'URLWithString:', 'app-settings:');\r\n\t\tplus.ios.invoke(app, 'openURL:', setting);\r\n\t\tplus.ios.deleteObject(setting);\r\n\t\tplus.ios.deleteObject(app);\r\n\t}\r\n\t}catch(e){\r\n\t\tconsole.error('exception in settingInIos@dc-push!!');\r\n\t}\r\n}\r\n/**\r\n * android打开应用设置页面\r\n */\r\nfunction settingInAndroid(){\r\n\tif (uni.getSystemInfoSync().platform == \"android\") {\r\n\t\tvar main = plus.android.runtimeMainActivity();\r\n\t\tvar Intent = plus.android.importClass('android.content.Intent');  \r\n\t\tvar Settings = plus.android.importClass('android.provider.Settings');  \r\n\t\tvar intent = new Intent(Settings.ACTION_APPLICATION_DETAILS_SETTINGS);\r\n\t\t// 安卓跳转设置页面详细查看(https://ask.dcloud.net.cn/question/14732)\r\n\t\tmain.startActivity(intent);\r\n\t}\r\n}\r\n/**\r\n * 打开应用设置界面\r\n */\r\nfunction setting(){\r\n\tif (uni.getSystemInfoSync().platform == \"ios\") {\r\n\t\tsettingInIos();\r\n\t}\r\n\tif (uni.getSystemInfoSync().platform == \"android\") {\r\n\t\tsettingInAndroid();\r\n\t}\r\n}\r\n\r\nexport default {\r\n\tisOn: isTurnedOnPush,\r\n\tiosSetting: settingInIos,\r\n\ton: turnOnPush,\r\n\toff: trunOffPush,\r\n\tsetting:setting\r\n}\r\n"],"names":["uni","setting"],"mappings":";;AAGA,SAAS,iBAAgB;AACxB,MAAI,OAAO;AACX,MAAG;AACF,QAAG,SAAS,KAAK,GAAG,MAAK;AACxB,UAAI,QAAQ;AACZ,UAAI,MAAM,KAAK,IAAI,OAAO,iBAAiB,mBAAmB;AAC9D,UAAI,WAAW,KAAK,IAAI,OAAO,KAAK,iCAAiC;AACrE,UAAG,UAAS;AACX,gBAAQ,SAAS,iBAAiB,OAAO;AACzC,aAAK,IAAI,aAAa,QAAQ;AAAA,MAClC,OAAQ;AACJ,gBAAQ,KAAK,IAAI,OAAO,KAAK,gCAAgC;AAAA,MAC7D;AACD,WAAK,IAAI,aAAa,GAAG;AACzB,aAAQ,KAAG;AAAA,IACd,OAAO;AACJ,UAAI,OAAO,KAAK,QAAQ,oBAAmB;AAC3C,UAAI,UAAU,KAAK,QAAQ,OAAO,8BAA8B,aAAa;AAC7E,aAAO,KAAK,QAAQ,OAAO,SAAS,kBAAkB,IAAI;AAAA,IAC1D;AAAA,EACD,SAAM,GAAE;AACRA,kBAAAA,MAAc,MAAA,SAAA,gDAAA,uCAAuC;AAAA,EACrD;AACD,SAAO;AACR;AAOA,SAAS,aAAY;AACpB,MAAG;AACF,QAAG,SAAS,KAAK,GAAG,MAAK;AAExB,UAAG,CAAC,eAAc,GAAG;AACpB;MACA;AAAA,IACJ,OAAO;AACJ,UAAI,OAAO,KAAK,QAAQ,oBAAmB;AAC3C,UAAI,UAAU,KAAK,QAAQ,OAAO,8BAA8B,aAAa;AAC7E,WAAK,QAAQ,OAAO,SAAS,cAAc,IAAI;AAAA,IAC/C;AAAA,EACD,SAAM,GAAE;AACRA,kBAAAA,MAAc,MAAA,SAAA,gDAAA,mCAAmC;AAAA,EACjD;AACF;AAOA,SAAS,cAAa;AACrB,MAAG;AACF,QAAG,SAAS,KAAK,GAAG,MAAK;AAAA,IAE3B,OAAO;AACJ,UAAI,OAAO,KAAK,QAAQ,oBAAmB;AAC3C,UAAI,UAAU,KAAK,QAAQ,OAAO,8BAA8B,aAAa;AAC7E,WAAK,QAAQ,OAAO,SAAS,eAAe,IAAI;AAAA,IAChD;AAAA,EACD,SAAM,GAAE;AACRA,kBAAAA,MAAc,MAAA,SAAA,gDAAA,oCAAoC;AAAA,EAClD;AACF;AAKA,SAAS,eAAc;AACtB,MAAG;AACH,QAAG,SAAS,KAAK,GAAG,MAAK;AACxB,UAAI,MAAM,KAAK,IAAI,OAAO,iBAAiB,mBAAmB;AAC9D,UAAIC,WAAU,KAAK,IAAI,OAAO,SAAS,kBAAkB,eAAe;AACxE,WAAK,IAAI,OAAO,KAAK,YAAYA,QAAO;AACxC,WAAK,IAAI,aAAaA,QAAO;AAC7B,WAAK,IAAI,aAAa,GAAG;AAAA,IACzB;AAAA,EACA,SAAM,GAAE;AACRD,kBAAAA,MAAc,MAAA,SAAA,gDAAA,qCAAqC;AAAA,EACnD;AACF;AAIA,SAAS,mBAAkB;AAC1B,MAAIA,oBAAI,oBAAoB,YAAY,WAAW;AAClD,QAAI,OAAO,KAAK,QAAQ,oBAAmB;AAC3C,QAAI,SAAS,KAAK,QAAQ,YAAY,wBAAwB;AAC9D,QAAI,WAAW,KAAK,QAAQ,YAAY,2BAA2B;AACnE,QAAI,SAAS,IAAI,OAAO,SAAS,mCAAmC;AAEpE,SAAK,cAAc,MAAM;AAAA,EACzB;AACF;AAIA,SAAS,UAAS;AACjB,MAAIA,oBAAI,oBAAoB,YAAY,OAAO;AAC9C;EACA;AACD,MAAIA,oBAAI,oBAAoB,YAAY,WAAW;AAClD;EACA;AACF;AAEA,MAAe,aAAA;AAAA,EACd,MAAM;AAAA,EACN,YAAY;AAAA,EACZ,IAAI;AAAA,EACJ,KAAK;AAAA,EACL;AACD;;"}