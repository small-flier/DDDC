{"version":3,"file":"list.js","sources":["pages/list/list.nvue","../../../../../HBuilderX.3.8.7.20230703/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvbGlzdC9saXN0Lm52dWU"],"sourcesContent":["<template>\r\n\t<view class=\"pages\">\r\n\t\t<!-- #ifndef H5 -->\r\n\t\t<statusBar></statusBar>\r\n\t\t<!-- #endif -->\r\n\r\n\t\t<!-- 搜索功能 -->\r\n\t\t<view class=\"uni-search-box\">\r\n\t\t\t<uni-search-bar v-model=\"keyword\" ref=\"searchBar\" radius=\"100\" cancelButton=\"none\" disabled\r\n\t\t\t\t:placeholder=\"inputPlaceholder\" />\r\n\t\t\t<view class=\"cover-search-bar\" @click=\"searchClick\"></view>\r\n\t\t</view>\r\n\r\n\t\t<unicloud-db ref='udb' v-slot:default=\"{data,pagination,hasMore, loading, error, options}\" @error=\"onqueryerror\"\r\n\t\t\t:collection=\"colList\" :page-size=\"10\"\n\t\t\t>\r\n\t\t\t<!-- 基于 uni-list 的页面布局 field=\"user_id.nickname\"-->\r\n\t\t\t<uni-list class=\"uni-list\" :border=\"false\" :style=\"{height:listHight}\">\r\n\t\t\t\t\n\t\t\t\t<!-- 作用于app端nvue页面的下拉加载 -->\n\t\t\t\t<!-- #ifdef APP-NVUE -->\n\t\t\t\t<refreshBox @refresh=\"refresh\" :loading=\"loading\"></refreshBox>\n\t\t\t\t<!-- #endif -->\r\n\n\t\t\t\t<!-- 列表渲染 -->\r\n\t\t\t\t<uni-list-item :to=\"'/pages/list/detail?id='+item._id+'&title='+item.title\" v-for=\"(item,index) in data\" :key=\"index\">\r\n\t\t\t\t\t<!-- 通过header插槽定义列表左侧图片 -->\r\n\t\t\t\t\t<template v-slot:header>\r\n\t\t\t\t\t\t<image class=\"avatar\" :src=\"item.avatar\" mode=\"aspectFill\"></image>\r\n\t\t\t\t\t</template>\r\n\t\t\t\t\t<!-- 通过body插槽定义布局 -->\r\n\t\t\t\t\t<template v-slot:body>\r\n\t\t\t\t\t\t<view class=\"main\">\r\n\t\t\t\t\t\t\t<text class=\"title\">{{item.title}}</text>\r\n\t\t\t\t\t\t\t<view class=\"info\">\r\n\t\t\t\t\t\t\t\t<text class=\"author\">{{item.user_id[0]?item.user_id[0].nickname:''}}</text>\r\n\t\t\t\t\t\t\t\t<uni-dateformat class=\"last_modify_date\" :date=\"item.last_modify_date\"\r\n\t\t\t\t\t\t\t\t\tformat=\"yyyy-MM-dd\" :threshold=\"[60000, 2592000000]\" />\r\n\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t</template>\r\n\t\t\t\t</uni-list-item>\n\t\t\t\t<!-- 加载状态：上拉加载更多，加载中，没有更多数据了，加载错误 -->\n\t\t\t\t<!-- #ifdef APP -->\n\t\t\t\t<uni-list-item>\n\t\t\t\t\t<template v-slot:body>\n\t\t\t\t<!-- #endif -->\r\n\t\t\t\t\t\t<uni-load-state class=\"load-state\" @networkResume=\"refresh\" :state=\"{data,pagination,hasMore, loading, error}\"\r\n\t\t\t\t\t\t\t@loadMore=\"loadMore\">\r\n\t\t\t\t\t\t</uni-load-state>\n\t\t\t\t<!-- #ifdef APP -->\n\t\t\t\t\t</template>\n\t\t\t\t</uni-list-item>\n\t\t\t\t<!-- #endif -->\r\n\t\t\t</uni-list>\r\n\t\t</unicloud-db>\n\t\t\n\t</view>\r\n</template>\r\n\r\n<script>\r\n\tlet cdbRef;\r\n\timport statusBar from \"@/uni_modules/uni-nav-bar/components/uni-nav-bar/uni-status-bar\";\r\n\r\n\timport Gps from '@/uni_modules/json-gps/js_sdk/gps.js';\r\n\tconst gps = new Gps(),db = uniCloud.database();\n\r\n\texport default {\r\n\t\tcomponents: {\r\n\t\t\tstatusBar\r\n\t\t},\r\n\t\tcomputed: {\r\n\t\t\tinputPlaceholder(e) {\r\n\t\t\t\tif (uni.getStorageSync('CURRENT_LANG') == \"en\") {\r\n\t\t\t\t\treturn 'Please enter the search content'\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn '请输入搜索内容'\r\n\t\t\t\t}\r\n\t\t\t},\n\t\t\tcolList(){\n\t\t\t\treturn [\n\t\t\t\t\tdb.collection('opendb-news-articles').where(this.where).field('avatar,title,last_modify_date,user_id').getTemp(),\n\t\t\t\t\tdb.collection('uni-id-users').field('_id,nickname').getTemp()\n\t\t\t\t]\n\t\t\t}\r\n\t\t},\r\n\t\tdata() {\r\n\t\t\treturn {\n\t\t\t\twhere: '\"article_status\" == 1',\r\n\t\t\t\tkeyword: \"\",\r\n\t\t\t\tshowRefresh: false,\r\n\t\t\t\tlistHight: 0\r\n\t\t\t}\r\n\t\t},\r\n\t\twatch: {\r\n\t\t\tkeyword(keyword, oldValue) {\r\n\t\t\t\tlet where = '\"article_status\" == 1 '\r\n\t\t\t\tif (keyword) {\r\n\t\t\t\t\tthis.where = where + `&& /${keyword}/.test(title)`;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.where = where;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tasync onReady() {\n\t\t\t// #ifdef APP-NVUE\r\n\t\t\t/* 可用窗口高度 - 搜索框高 - 状态栏高 */\r\n\t\t\tthis.listHight = uni.getSystemInfoSync().windowHeight - uni.getSystemInfoSync().statusBarHeight - 50 + 'px';\r\n\t\t\t// #endif\r\n\t\t\t// #ifndef APP-NVUE\r\n\t\t\tthis.listHight = 'auto'\r\n\t\t\t// #endif\r\n\t\t\tcdbRef = this.$refs.udb\r\n\t\t},\r\n\t\tasync onShow() {\r\n\t\t\tthis.keyword = getApp().globalData.searchText\r\n\t\t\tgetApp().globalData.searchText = ''\r\n\t\t\t//这里仅演示如何，在onShow生命周期获取设备位置，并在设备或者应用没有权限时自动引导。设置完毕自动重新获取。\r\n\t\t\t//你可以基于他做自己的业务，比如：根据距离由近到远排序列表数据等\r\n\t\t\t// uni.showLoading({\r\n\t\t\t// \ttitle:\"获取定位中\"\r\n\t\t\t// });\r\n\t\t\t//默认h5端不获取定位\r\n\t\t\t// #ifndef H5 || APP-HARMONY\r\n\t\t\tlet location = await gps.getLocation({\r\n\t\t\t\tgeocode: true\r\n\t\t\t})\r\n\t\t\t// console.log(location);\r\n\t\t\t// #endif\r\n\t\t\t// if(location){\r\n\t\t\t// \tuni.showToast({\r\n\t\t\t// \t\ttitle: JSON.stringify(location),\r\n\t\t\t// \t\ticon: 'none'\r\n\t\t\t// \t});\r\n\t\t\t// }\r\n\t\t\t// uni.hideLoading()\r\n\t\t},\r\n\t\tmethods: {\r\n\t\t\tsearchClick(e) { //点击搜索框\r\n\t\t\t\tuni.hideKeyboard();\r\n\t\t\t\tuni.navigateTo({\r\n\t\t\t\t\turl: '/pages/list/search/search',\r\n\t\t\t\t\tanimationType: 'fade-in'\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\tretry() {\r\n\t\t\t\tthis.refresh()\r\n\t\t\t},\r\n\t\t\trefresh() {\r\n\t\t\t\tcdbRef.loadData({\r\n\t\t\t\t\tclear: true\r\n\t\t\t\t}, () => {\r\n\t\t\t\t\tuni.stopPullDownRefresh()\n\t\t\t\t\t// #ifdef APP-NVUE\n\t\t\t\t\tthis.showRefresh = false\n\t\t\t\t\t// #endif\n\t\t\t\t\tconsole.log('end');\r\n\t\t\t\t})\r\n\t\t\t\tconsole.log('refresh');\r\n\t\t\t},\r\n\t\t\tloadMore() {\r\n\t\t\t\tcdbRef.loadMore()\r\n\t\t\t},\r\n\t\t\tonqueryerror(e) {\r\n\t\t\t\tconsole.error(e);\r\n\t\t\t},\r\n\t\t\tonpullingdown(e) {\r\n\t\t\t\tconsole.log(e);\n\t\t\t\tthis.showRefresh = true\n\t\t\t\tif(e.pullingDistance>100){\n\t\t\t\t\tthis.refresh()\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\t// #ifndef APP-NVUE\n\t\tonPullDownRefresh() {\n\t\t\tthis.refresh()\n\t\t},\n\t\tonReachBottom() {\n\t\t\tthis.loadMore()\n\t\t}\n\t\t// #endif\r\n\t}\r\n</script>\r\n\r\n<style scoped>\r\n\t/* #ifndef APP-NVUE */\r\n\tview {\r\n\t\tdisplay: flex;\r\n\t\tbox-sizing: border-box;\r\n\t\tflex-direction: column;\r\n\t}\r\n\t/* #endif */\r\n\t.pages {\r\n\t\tbackground-color: #FFFFFF;\r\n\t}\r\n\r\n\t.avatar {\r\n\t\twidth: 200rpx;\r\n\t\theight: 200rpx;\r\n\t\tmargin-right: 10rpx;\r\n\t}\r\n\r\n\t.main {\n\t\tjustify-content: space-between;\n\t\tflex: 1;\r\n\t}\r\n\r\n\t.title {\r\n\t\tfont-size: 16px;\r\n\t}\r\n\r\n\t.info {\r\n\t\tflex-direction: row;\r\n\t\tjustify-content: space-between;\r\n\t}\r\n\r\n\t.author,\r\n\t.last_modify_date {\r\n\t\tfont-size: 14px;\r\n\t\tcolor: #999999;\r\n\t}\r\n\r\n\t.uni-search-box {\r\n\t\tbackground-color: #FFFFFF;\r\n\t\tposition: sticky;\r\n\t\theight: 50px;\r\n\t\ttop: 0;\r\n\t\tleft: 0;\r\n\t\t/* #ifndef APP-PLUS */\r\n\t\tz-index: 9;\r\n\t\t/* #endif */\r\n\t\t/* #ifdef MP-WEIXIN */\r\n\t\twidth: 580rpx;\r\n\t\t/* #endif */\r\n\t}\r\n\t.cover-search-bar {\r\n\t\theight: 50px;\r\n\t\tposition: relative;\r\n\t\ttop: -50px;\r\n\t\tmargin-bottom: -50px;\r\n\t\t/* #ifndef APP-NVUE */\r\n\t\tz-index: 999;\r\n\t\t/* #endif */\r\n\t}\r\n  .load-state{\r\n    justify-content: center;\r\n    width: 750rpx;\r\n  }\r\n</style>\n","import MiniProgramPage from 'C:/Users/93152/Desktop/转转转/DDDC/pages/list/list.nvue'\nwx.createPage(MiniProgramPage)"],"names":["Gps","uniCloud","uni"],"mappings":";;;AA6DC,IAAI;AACJ,MAAK,YAAa,MAAW;AAG7B,MAAM,MAAM,IAAIA,+BAAG,IAAA,GAAG,KAAKC,cAAAA,GAAS;AAEpC,MAAK,YAAU;AAAA,EACd,YAAY;AAAA,IACX;AAAA,EACA;AAAA,EACD,UAAU;AAAA,IACT,iBAAiB,GAAG;AACnB,UAAIC,oBAAI,eAAe,cAAc,KAAK,MAAM;AAC/C,eAAO;AAAA,aACD;AACN,eAAO;AAAA,MACR;AAAA,IACA;AAAA,IACD,UAAS;AACR,aAAO;AAAA,QACN,GAAG,WAAW,sBAAsB,EAAE,MAAM,KAAK,KAAK,EAAE,MAAM,uCAAuC,EAAE,QAAS;AAAA,QAChH,GAAG,WAAW,cAAc,EAAE,MAAM,cAAc,EAAE,QAAQ;AAAA,MAC7D;AAAA,IACD;AAAA,EACA;AAAA,EACD,OAAO;AACN,WAAO;AAAA,MACN,OAAO;AAAA,MACP,SAAS;AAAA,MACT,aAAa;AAAA,MACb,WAAW;AAAA,IACZ;AAAA,EACA;AAAA,EACD,OAAO;AAAA,IACN,QAAQ,SAAS,UAAU;AAC1B,UAAI,QAAQ;AACZ,UAAI,SAAS;AACZ,aAAK,QAAQ,QAAQ,OAAO,OAAO;AAAA,aAC7B;AACN,aAAK,QAAQ;AAAA,MACd;AAAA,IACD;AAAA,EACA;AAAA,EACD,MAAM,UAAU;AAMf,SAAK,YAAY;AAEjB,aAAS,KAAK,MAAM;AAAA,EACpB;AAAA,EACD,MAAM,SAAS;AACd,SAAK,UAAU,OAAQ,EAAC,WAAW;AACnC,WAAQ,EAAC,WAAW,aAAa;AAQlB,UAAM,IAAI,YAAY;AAAA,MACpC,SAAS;AAAA,KACT;AAAA,EAUD;AAAA,EACD,SAAS;AAAA,IACR,YAAY,GAAG;AACdA,oBAAG,MAAC,aAAY;AAChBA,oBAAAA,MAAI,WAAW;AAAA,QACd,KAAK;AAAA,QACL,eAAe;AAAA,MAChB,CAAC;AAAA,IACD;AAAA,IACD,QAAQ;AACP,WAAK,QAAQ;AAAA,IACb;AAAA,IACD,UAAU;AACT,aAAO,SAAS;AAAA,QACf,OAAO;AAAA,MACR,GAAG,MAAM;AACRA,sBAAAA,MAAI,oBAAoB;AAIxBA,sBAAAA,MAAY,MAAA,OAAA,+BAAA,KAAK;AAAA,OACjB;AACDA,oBAAAA,MAAA,MAAA,OAAA,+BAAY,SAAS;AAAA,IACrB;AAAA,IACD,WAAW;AACV,aAAO,SAAS;AAAA,IAChB;AAAA,IACD,aAAa,GAAG;AACfA,oBAAAA,oDAAc,CAAC;AAAA,IACf;AAAA,IACD,cAAc,GAAG;AAChBA,oBAAAA,kDAAY,CAAC;AACb,WAAK,cAAc;AACnB,UAAG,EAAE,kBAAgB,KAAI;AACxB,aAAK,QAAQ;AAAA,MACd;AAAA,IACD;AAAA,EACA;AAAA,EAED,oBAAoB;AACnB,SAAK,QAAQ;AAAA,EACb;AAAA,EACD,gBAAgB;AACf,SAAK,SAAS;AAAA,EACf;AAED;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACrLD,GAAG,WAAW,eAAe;"}