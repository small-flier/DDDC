{"version":3,"file":"menu.js","sources":["pages/menu/menu.vue","../../../../../HBuilderX.3.8.7.20230703/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvbWVudS9tZW51LnZ1ZQ"],"sourcesContent":["<template>\n  <view class=\"menu\">\n    <uni-forms\n      ref=\"baseFormRef\"\n      :rules=\"rules\"\n      :modelValue=\"formData\"\n      label-position=\"top\"\n    >\n      <uni-forms-item label=\"菜名\" required name=\"name\">\n        <uni-easyinput v-model=\"formData.name\" placeholder=\"请输入菜名\" />\n      </uni-forms-item>\n      <uni-forms-item label=\"图片\">\n        <uni-file-picker\n          v-model=\"imageValue\"\n          fileMediatype=\"image\"\n          mode=\"grid\"\n          @select=\"select\"\n          @progress=\"progress\"\n          @success=\"success\"\n          @fail=\"fail\"\n          :limit=\"1\"\n        />\n      </uni-forms-item>\n    </uni-forms>\n    <button type=\"primary\" :loading=\"loading\" @click=\"formSubmit\">提交</button>\n  </view>\n</template>\n\n<script>\nexport default {\n  onShow() {\n    const params = uni.getStorageSync(\"tabbarParams\");\n    if (params.id) {\n      uni.removeStorageSync(\"tabbarParams\");\n      const db = uniCloud.database();\n      db.collection(\"menu\")\n        .where({\n          _id: params.id,\n        })\n        .get()\n        .then((res) => {\n          if (res.result && res.result.data) {\n            this.formData = res.result.data[0];\n            this.imageValue = res.result.data[0].file;\n          }\n        });\n    }\n  },\n  onHide() {},\n  data() {\n    return {\n      imageValue: [],\n      formData: {},\n      rules: {\n        name: {\n          rules: [\n            {\n              required: true,\n              errorMessage: \"菜名不能为空\",\n            },\n          ],\n        },\n      },\n      loading: false,\n      isUpload: false,\n    };\n  },\n  methods: {\n    formSubmit() {\n      this.$refs.baseFormRef\n        .validate()\n        .then((res) => {\n          let data = { ...this.formData };\n          if (this.imageValue && this.imageValue[0]) {\n            const { name, extname, url } = this.imageValue[0];\n            data = {\n              ...this.formData,\n              file: {\n                name,\n                extname,\n                url,\n              },\n            };\n          }\n          if (this.isUpload) {\n            uni.showToast({\n              title: \"请等待图片上传完成\",\n              icon: \"none\",\n            });\n            return;\n          }\n          this.loading = true;\n          // 根据编辑或者新增，来处理不同的方式\n          if (this.formData._id) {\n            this.update(data);\n            return;\n          }\n          this.add(data);\n        })\n        .catch((err) => {\n          console.log(\"err\", err);\n        });\n    },\n    add(data) {\n      const db = uniCloud.database();\n      db.collection(\"menu\")\n        .add(data)\n        .then((res) => {\n          this.operSuccess();\n        })\n        .catch((err) => {\n          console.error(\"新增失败\", err);\n        })\n        .finally(() => {\n          this.loading = false;\n        });\n    },\n    update(data) {\n      const db = uniCloud.database();\n      db.collection(\"menu\")\n        .where({ _id: this.formData._id })\n        .update(data)\n        .then(() => {\n          this.operSuccess();\n        })\n        .finally(() => {\n          this.loading = false;\n        });\n    },\n    operSuccess() {\n      uni.showToast({\n        title: \"操作成功\",\n      });\n      setTimeout(() => {\n        // 清除一下表单数据\n        this.imageValue = [];\n        this.formData = {};\n        uni.setStorageSync(\"needFetch\", true);\n        uni.switchTab({\n          url: \"/pages/grid/grid\",\n        });\n      }, 1000);\n    },\n    // 获取上传状态\n    select(e) {\n      this.isUpload = true;\n      console.log(\"选择文件：\", e);\n    },\n    // 获取上传进度\n    progress(e) {\n      console.log(\"上传进度：\", e);\n    },\n\n    // 上传成功\n    success(e) {\n      console.log(\"上传成功\", e);\n      this.isUpload = false;\n    },\n\n    // 上传失败\n    fail(e) {\n      console.log(\"上传失败：\", e);\n      this.noClear = false;\n    },\n  },\n};\n</script>\n\n<style lang=\"scss\">\n.menu {\n  padding: 30rpx;\n}\n</style>\n","import MiniProgramPage from 'C:/Users/93152/Desktop/转转转/DDDC/pages/menu/menu.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni","uniCloud"],"mappings":"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"}