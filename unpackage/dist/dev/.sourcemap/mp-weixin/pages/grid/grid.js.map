{"version":3,"file":"grid.js","sources":["pages/grid/grid.vue","../../../../../HBuilderX.3.8.7.20230703/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvZ3JpZC9ncmlkLnZ1ZQ"],"sourcesContent":["<template>\n  <view class=\"warp\">\n    <!-- #ifdef APP -->\n    <statusBar></statusBar>\n    <!-- #endif -->\n\n    <!-- banner -->\n    <unicloud-db\n      ref=\"bannerdb\"\n      v-slot:default=\"{ data, loading, error, options }\"\n      collection=\"opendb-banner\"\n      field=\"_id,bannerfile,open_url,title\"\n      @load=\"onqueryload\"\n    >\n      <!-- 当无banner数据时显示占位图 -->\n      <image\n        v-if=\"!(loading || data.length)\"\n        class=\"banner-image\"\n        src=\"/static/uni-center/headers.png\"\n        mode=\"aspectFill\"\n        :draggable=\"false\"\n      />\n\n      <swiper\n        v-else\n        class=\"swiper-box\"\n        @change=\"changeSwiper\"\n        :current=\"current\"\n        indicator-dots\n      >\n        <swiper-item v-for=\"(item, index) in data\" :key=\"item._id\">\n          <image\n            class=\"banner-image\"\n            :src=\"item.bannerfile.url\"\n            mode=\"aspectFill\"\n            @click=\"clickBannerItem(item)\"\n            :draggable=\"false\"\n          />\n        </swiper-item>\n      </swiper>\n    </unicloud-db>\n\n    <!-- 宫格 -->\n    <view class=\"section-box\">\n      <text class=\"decoration\"></text>\n      <text class=\"section-text\">嘟嘟点餐</text>\n    </view>\n\n    <!-- :options=\"{ forceUpdate: true }\" -->\n    <unicloud-db\n      ref=\"udb\"\n      v-slot:default=\"{ data, loading, error, options }\"\n      collection=\"menu\"\n      field=\"name,file\"\n      @load=\"handleLoad\"\n    >\n      <view class=\"example-body\">\n        <view v-for=\"(item, i) in data\" :key=\"i\">\n          <view class=\"example-body__title\">{{ i + 1 }}</view>\n          <view @click=\"() => handleClick(item)\">\n            <view\n              style=\"\n                width: 100%;\n                height: 400rpx;\n                border: 1px solid rgb(243 243 243);\n                border-radius: 22rpx;\n              \"\n            >\n              <image\n                v-if=\"item.file && item.file.url\"\n                :src=\"item.file.url\"\n                class=\"image\"\n                mode=\"aspectFill\"\n              />\n              <view\n                style=\"\n                  height: 100%;\n                  display: flex;\n                  justify-content: center;\n                  align-items: center;\n                  color: #dedede;\n                \"\n                v-else\n              >\n                暂未上传封面\n              </view>\n            </view>\n            <view style=\"text-align: center\">\n              <text class=\"big-number\">{{ item.name }}</text>\n            </view>\n          </view>\n        </view>\n      </view>\n      <uni-load-more\n        :status=\"loading ? 'loading' : loadMoreStatus\"\n      ></uni-load-more>\n    </unicloud-db>\n    <!-- 编辑 -->\n    <uni-popup ref=\"popup\" type=\"bottom\" background-color=\"#fff\" safe-area>\n      <view style=\"padding: 40rpx 40rpx 160rpx\">\n        <view class=\"warp-title\">\n          <text>{{ formData.name }}</text>\n        </view>\n        <button\n          plain\n          size=\"default\"\n          type=\"success\"\n          hover-class=\"is-hover\"\n          @click=\"handleView\"\n        >\n          查看大图\n        </button>\n        <button\n          plain\n          style=\"margin-top: 20rpx\"\n          size=\"default\"\n          type=\"primary\"\n          hover-class=\"is-hover\"\n          @click=\"handleEdit\"\n        >\n          编辑\n        </button>\n        <button\n          style=\"margin-top: 20rpx\"\n          size=\"default\"\n          type=\"warn\"\n          hover-class=\"is-hover\"\n          @click=\"handleDel\"\n        >\n          删除\n        </button>\n      </view>\n    </uni-popup>\n  </view>\n</template>\n\n<script>\n// #ifdef APP\nimport statusBar from \"@/uni_modules/uni-nav-bar/components/uni-nav-bar/uni-status-bar\";\n// #endif\n\nexport default {\n  // #ifdef APP\n  components: {\n    statusBar,\n  },\n  // #endif\n  data() {\n    return {\n      currentPage: 1,\n      current: 0,\n      hasLogin: false,\n      rules: {\n        // 对name字段进行必填验证\n        name: {\n          rules: [\n            {\n              required: true,\n              errorMessage: \"菜名必填\",\n            },\n          ],\n        },\n      },\n      loadMoreStatus: \"more\",\n      formData: {},\n      noNeedFetfh: false,\n    };\n  },\n  onPullDownRefresh() {\n    this.$refs.udb.loadData(\n      {\n        clear: true,\n      },\n      () => {\n        uni.stopPullDownRefresh();\n      }\n    );\n  },\n  onReachBottom() {\n    this.$refs.udb.loadMore();\n  },\n  onShow() {\n    const needFetch = uni.getStorageSync(\"needFetch\");\n    if (needFetch) {\n      this.$refs.udb?.reset();\n      this.$refs.udb?.refresh();\n      uni.setStorageSync(\"needFetch\", false);\n    }\n  },\n  onLoad() {},\n  methods: {\n    change(e) {\n      // const db = uniCloud.database()\n      // db.collection('menu')\n      //   .get()\n      //   .then((res) => {\n      //     // res 为数据库查询结果\n      //     console.log(res, '结果啊')\n      //   })\n      //   .catch((e) => {\n      //     console.log(e)\n      //   })\n      uni.showToast({\n        title:\n          this.$t(\"grid.clickTip\") +\n          \" \" +\n          `${e.detail.index + 1}` +\n          \" \" +\n          this.$t(\"grid.clickTipGrid\"),\n        icon: \"none\",\n      });\n    },\n    /**\n     * banner加载后触发的回调\n     */\n    onqueryload(data) {},\n    changeSwiper(e) {\n      this.current = e.detail.current;\n    },\n    /**\n     * 点击banner的处理\n     */\n    clickBannerItem(item) {\n      // 有外部链接-跳转url\n      if (item.open_url) {\n        uni.navigateTo({\n          url:\n            \"/uni_modules/uni-id-pages/pages/common/webview/webview?url=\" +\n            item.open_url +\n            \"&title=\" +\n            item.title,\n          success: (res) => {},\n          fail: () => {},\n          complete: () => {},\n        });\n      }\n      // 其余业务处理\n    },\n    handleClick(item) {\n      this.formData = { ...item };\n      this.$refs.popup.open();\n      // const hO = {\n      //   0: () => {\n      //     this.handleEdit();\n      //   },\n      //   1: () => {\n      //     this.handleDel(item);\n      //   },\n      // };\n      // hO[e.index]();\n    },\n    handleView() {\n      if (this.formData?.file?.url) {\n        uni.previewImage({\n          current: 0, // 当前显示图片的索引\n          urls: [this.formData.file.url], // 需要预览的图片列表\n        });\n\n        return;\n      }\n      uni.showToast({\n        title: \"这道菜没有上传图片\",\n        icon: \"none\",\n        duration: 2000,\n        mask: true,\n      });\n      // debugger;\n    },\n    handleEdit() {\n      // 编辑\n      // 这他妈什么bug\n      setTimeout(() => {\n        // this.$refs.popup.open();\n        const id = this.formData._id;\n        uni.setStorageSync(\"tabbarParams\", { id });\n        this.$refs.popup.close();\n        uni.switchTab({\n          url: `/pages/menu/menu`,\n        });\n      }, 300);\n    },\n    handleDel() {\n      // 删除\n      this.$refs.udb.remove(this.formData._id, {\n        success: () => {\n          uni.showToast({\n            title: \"删除成功\",\n            icon: \"none\",\n          });\n          this.$refs.popup.close();\n          // 刷新列表\n        },\n      });\n    },\n    // submit() {\n    //   this.$refs.formRef\n    //     .validate()\n    //     .then((res) => {\n    //       this.$refs.udb.update(\n    //         this.formData._id,\n    //         {\n    //           name: this.formData.name,\n    //         },\n    //         {\n    //           success: () => {\n    //             this.$refs.popup.close();\n    //             this.$refs.udb.refresh();\n    //           },\n    //         }\n    //       );\n    //     })\n    //     .catch((err) => {\n    //       console.log(\"表单错误信息：\", err);\n    //     });\n    // },\n    handleLoad(data, ended) {\n      this.loadMoreStatus = ended ? \"noMore\" : \"more\"; // oading 的状态，可选值：more（loading前）、loading（loading中）、noMore（没有更多了）\n    },\n  },\n};\n</script>\n\n<style>\n/* #ifndef APP-NVUE */\npage {\n  display: flex;\n  flex-direction: column;\n  box-sizing: border-box;\n  background-color: #fff;\n  min-height: 100%;\n  height: auto;\n}\nview {\n  font-size: 14px;\n  line-height: inherit;\n}\n/* #endif */\n\n.section-box {\n  display: flex;\n  flex-direction: row;\n  align-items: center;\n  padding: 20rpx;\n}\n.decoration {\n  width: 4px;\n  height: 12px;\n  border-radius: 10px;\n  background-color: #2979ff;\n}\n.section-text {\n  color: #333;\n  margin-left: 15rpx;\n}\n\n.example-body {\n  display: grid;\n  grid-template-columns: repeat(2, 1fr);\n  gap: 30rpx;\n  padding: 0 15px 15px;\n  background-color: #ffffff;\n}\n\n.example-body__title {\n  font-size: 70rpx;\n  font-style: oblique;\n  font-weight: bold;\n  background: linear-gradient(180deg, #2979ff 0%, #00ff43 100%);\n  background-clip: text;\n  -webkit-text-fill-color: transparent;\n}\n\n.image {\n  width: 100%;\n  height: 100%;\n  border-radius: 22rpx;\n}\n\n.big-number {\n  font-size: 30rpx;\n  font-weight: 500;\n  font-stretch: condensed;\n  /* font-style: oblique; */\n  background: linear-gradient(-180deg, #2979ff 20%, #00ff43 100%);\n  background-clip: text;\n  -webkit-text-fill-color: transparent;\n}\n\n.text {\n  text-align: center;\n  font-size: 26rpx;\n  margin-top: 10rpx;\n}\n\n.banner-image {\n  width: 100%;\n  height: 400rpx;\n}\n\n.swiper-box {\n  height: 400rpx;\n}\n\n.search-container-bar {\n  /* #ifndef APP-NVUE */\n  display: flex;\n  /* #endif */\n  flex-direction: row;\n  justify-content: center;\n  align-items: center;\n  position: fixed;\n  left: 0;\n  right: 0;\n  z-index: 10;\n  background-color: #fff;\n}\n\n.uni-grid-item {\n  box-sizing: border-box;\n  padding: 20rpx;\n}\n\n.warp-title {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  font-size: 20px;\n  font-weight: 500;\n  margin-bottom: 30rpx;\n  /* font-style: oblique; */\n}\n\n/* #ifndef APP-NVUE || VUE3*/\n::v-deep\n\t/* #endif */\n\t.uni-searchbar__box {\n  border-width: 0;\n}\n\n/* #ifndef APP-NVUE || VUE3 */\n::v-deep\n\t/* #endif */\n\t.uni-input-placeholder {\n  font-size: 28rpx;\n}\n</style>\n","import MiniProgramPage from 'C:/Users/93152/Desktop/转转转/DDDC/pages/grid/grid.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni"],"mappings":"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"}